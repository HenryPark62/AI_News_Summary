<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>News.ai</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<div class="container">
    <h1 class="main-title">
        <span id="news-icon" class="emoji-large">ğŸ“°</span>
        <span class="title-text">News.ai</span>
    </h1>

    <h3 id="typing-text"><span id="typed-text"></span><span id="cursor">|</span></h3>
    
    <div id="headline-ticker" class="headline-ticker"></div>

    <form method="POST" enctype="multipart/form-data" action="/start-summary" id="summary-form">

        <!-- 1ë‹¨ê³„: ìš”ì•½ ëª¨ë¸ ì„ íƒ (ì²˜ìŒë¶€í„° ë³´ì„) -->
        <div class="fade-step show" id="step-1">
            <h3>ğŸ§  ìš”ì•½ ëª¨ë¸ ì„ íƒ</h3>
            <label><input type="radio" name="model" value="perplexity"> Perplexity.ai</label>
            <label><input type="radio" name="model" value="together"> Together.ai</label>
            <label><input type="radio" name="model" value="local"> ë¡œì»¬ LLM (ollama ë“±)</label>
        </div>

        <!-- 2ë‹¨ê³„: ìš”ì•½ ìŠ¤íƒ€ì¼ ì„ íƒ (ê¸°ë³¸ ìˆ¨ê¹€) -->
        <div class="fade-step hidden" id="step-2">
            <h3>ğŸ“ ìš”ì•½ ìŠ¤íƒ€ì¼ ì„ íƒ</h3>
            <label><input type="radio" name="style" value="brief"> ê°„ê²° ìš”ì•½ (2~3ì¤„)</label>
            <label><input type="radio" name="style" value="detailed"> ìƒì„¸ ìš”ì•½ (5~7ì¤„)</label>
        </div>

        <!-- 3ë‹¨ê³„: ë‰´ìŠ¤ ì…ë ¥ ì„ íƒ (ê¸°ë³¸ ìˆ¨ê¹€) -->
        <div class="fade-step hidden" id="step-3">
            <h3>ğŸ“° ë‰´ìŠ¤ ì…ë ¥</h3>

            <div class="input-choice">
                <div class="upload-area">
                    <h4>ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ (.txt)</h4>
                    <label for="file-upload" class="custom-file-upload">
                        ğŸ“‚ íŒŒì¼ ì„ íƒ
                    </label>
                    <input id="file-upload" type="file" name="file" accept=".txt" style="display: none;">
                </div>

                <br>
                <div class="or-text">ë˜ëŠ”</div>

                <div class="textarea-area">
                    <h4>âœï¸ í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥</h4>
                    <textarea name="text_content" rows="6" placeholder="ë‰´ìŠ¤ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                </div>

                <br>
                <div class="or-text">ë˜ëŠ”</div>

                <div class="url-input-area">
                    <h4>ğŸ”— ë‰´ìŠ¤ URL ì…ë ¥</h4>
                    <input type="text" name="news_url" placeholder="https://n.news.naver.com/article/..." style="width:100%; padding: 10px; font-size: 14px;">

                    <div style="margin-top: 10px; text-align: center;">
                        <label><strong>ì–¸ë¡ ì‚¬ ì„ íƒ:</strong></label>
                        <div style="display: flex; justify-content: center; gap: 20px; margin-top: 5px;">
                            <label><input type="radio" name="news_source" value="naver" required> ë„¤ì´ë²„ ë‰´ìŠ¤</label>
                            <label><input type="radio" name="news_source" value="annnews"> ANN News(ì¼ë³¸)</label>
                            <label><input type="radio" name="news_source" value="foxnews"> Fox News(ë¯¸êµ­)</label>
                        </div>
                    </div>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ ì´ë¦„ í‘œì‹œìš© -->
                <div id="file-name" class="file-name"></div>

                <!-- í…ìŠ¤íŠ¸ ì…ë ¥ ê¸€ììˆ˜ í‘œì‹œìš© -->
                <div id="text-count" class="text-count">0ì ì…ë ¥ë¨</div>
            </div>
        </div>

        <!-- ìµœì¢… ìš”ì•½ ì‹œì‘ ë²„íŠ¼ -->
        <div class="start-btn">
            <button type="submit" id="start-button" disabled>ğŸš€ ìš”ì•½ ì‹œì‘</button>
        </div>

    </form>

<script src="{{ url_for('static', filename='js/validate.js') }}"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const textContainer = document.getElementById('typed-text');
    const texts = [
        "AIê°€ ì½ê³ , ë‹¹ì‹ ì€ ì´í•´ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.",
        "ë‰´ìŠ¤ë¥¼ ë” ë¹ ë¥´ê²Œ!",
        "ì´í•´ë§Œ í•˜ë©´ ë!",
        "ë‹¹ì‹ ì˜ ì‹œê°„ì€ ì†Œì¤‘í•©ë‹ˆë‹¤.",
        "í•µì‹¬ë§Œ ê³¨ë¼ì£¼ëŠ” AI ìš”ì•½",
        "ë‰´ìŠ¤, ë” ì´ìƒ ê¸¸ê²Œ ì½ì§€ ë§ˆì„¸ìš”",
        "ë°”ìœ ë‹¹ì‹ ì„ ìœ„í•œ ì´ˆê°„í¸ ìš”ì•½",
        "ì½ëŠ” ë° 1ë¶„, ì´í•´ëŠ” 10ì´ˆ",
        "ë³µì¡í•œ ë‰´ìŠ¤, ì‰½ê³  ë¹ ë¥¸ ì´í•´",
        "ì¤‘ìš”í•œ ì •ë³´ë§Œ í•œëˆˆì—",
        "News.aiê°€ í•µì‹¬ì„ ë½‘ì•„ë“œë¦½ë‹ˆë‹¤!"

    ];
    let currentText = "";
    let charIndex = 0;
    let isDeleting = false;

    function getRandomSpeed(min, max) {
        return Math.random() * (max - min) + min;
    }

    function pickRandomText() {
        const randomIndex = Math.floor(Math.random() * texts.length);
        return texts[randomIndex];
    }

    function typeEffect() {
        if (!currentText) {
            currentText = pickRandomText();
        }

        if (!isDeleting) {
            // ìƒˆ ê¸€ì ì¶”ê°€
            const nextChar = currentText.charAt(charIndex);
            const span = document.createElement('span');
            span.textContent = nextChar;
            span.classList.add('fade-in-char');
            textContainer.appendChild(span);
            charIndex++;

            if (charIndex === currentText.length) {
                isDeleting = true;
                setTimeout(typeEffect, 1200); // ë‹¤ íƒ€ì´í•‘í•˜ë©´ ì ê¹ ë©ˆì¶¤
                return;
            }
        } else {
            // ì‚­ì œëŠ” ë§ˆì§€ë§‰ ê¸€ì í•˜ë‚˜ ì œê±°
            if (textContainer.lastChild) {
                textContainer.removeChild(textContainer.lastChild);
            }
            charIndex--;

            if (charIndex === 0) {
                isDeleting = false;
                currentText = pickRandomText();
            }
        }

        const speed = isDeleting ? 40 : getRandomSpeed(80, 150);
        setTimeout(typeEffect, speed);
    }

    typeEffect();
});

/* --- ë‰´ìŠ¤ í—¤ë“œë¼ì¸ í‹°ì»¤ JS --- */
let headlines = [];
let idx = 0;

function fetchHeadlines() {
    fetch('/api/latest-headlines')
        .then(res => res.json())
        .then(data => {
            // [{title, link}, ...] í˜•íƒœ
            headlines = data.headlines;
            idx = 0;
            showNextHeadline();
        });
}

function showNextHeadline() {
    if (headlines.length === 0) return;
    const ticker = document.getElementById('headline-ticker');
    const headline = headlines[idx];
    // a íƒœê·¸ë¡œ ê°ì‹¸ì„œ í´ë¦­ ì‹œ ìƒˆ ì°½ì—ì„œ ì›ë¬¸ ì—´ê¸°
    ticker.innerHTML = `<a href="${headline.link}" target="_blank" style="color:inherit; text-decoration:none;">${headline.title}</a>`;
    idx = (idx + 1) % headlines.length;
    setTimeout(showNextHeadline, 5000);
}

document.addEventListener('DOMContentLoaded', function() {
    fetchHeadlines();
    setInterval(fetchHeadlines, 60000);
});
</script>
</div>

</body>
</html>